import{toPromise as e,take as t,share as n,filter as r,map as i,tap as o,merge as u,mergeMap as s,takeUntil as c,make as p,onPush as l,makeSubject as d,publish as y,onStart as k,onEnd as v,switchMap as x,fromValue as O,interval as q,subscribe as b}from"wonka";import{k as w,_ as E,s as _,C as S,m as P,a as j,b as R,c as M,d as D,e as Q,f as A}from"./70b0ab30.min.mjs";import{visit as I}from"graphql/language/visitor.mjs";import{Kind as N}from"graphql/language/kinds.mjs";import{print as L}from"graphql/language/printer.mjs";export{C as CombinedError,f as createRequest,h as getOperationName,a as makeErrorResult,m as makeResult,g as stringifyVariables}from"./70b0ab30.min.mjs";function T(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)T(e[n],t);else if("object"==typeof e&&null!==e)for(n in e)"__typename"===n&&"string"==typeof e[n]?t[e[n]]=0:T(e[n],t);return t}function F(e){return e.kind===N.FIELD&&"__typename"===e.name.value&&!e.alias}function $(e){if(e.selectionSet&&!e.selectionSet.selections.some(F))return E({},e,{selectionSet:E({},e.selectionSet,{selections:e.selectionSet.selections.concat([{kind:N.FIELD,name:{kind:N.NAME,value:"__typename"}}])})})}var G=new Map;function J(e){e=w(e);var t=G.get(e.__key);return t||((t=I(e,{Field:$,InlineFragment:$})).__key=e.__key,G.set(e.__key,t)),t}function U(e){return e&&"object"==typeof e?Object.keys(e).reduce((function(t,n){var r=e[n];return"__typename"===n?Object.defineProperty(t,"__typename",{enumerable:!1,value:r}):t[n]=Array.isArray(r)?r.map(U):r&&"object"==typeof r&&"__typename"in r?U(r):r,t}),{}):e}function V(n){return n.toPromise=function(){return e(t(1)(n))},n}function z(e,t,n){return n||(n=t.context),{key:t.key,query:t.query,variables:t.variables,kind:e,context:n,get operationName(){return this.kind}}}function B(e,t){return z(e.kind,e,E({},e.context,{meta:E({},e.context.meta,t)}))}function H(){}function K(e,t,n){for(var r=0;r<n.length;r++)if(n[r].kind===N.FRAGMENT_DEFINITION){var i=n[r].name.value,o=_(n[r]);e.has(i)||(e.set(i,o),t.push(n[r]))}else t.push(n[r])}function W(e){return"subscription"!==(e=e.kind)&&"query"!==e}function X(e){return e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message}function Y(e){return"mutation"!==(e=e.kind)&&"query"!==e}function Z(e){var t=z(e.kind,e);return t.query=J(e.query),t}function ee(e){return"query"!==e.kind||"cache-only"!==e.context.requestPolicy}function te(e){return B(e,{cacheOutcome:"miss"})}function ne(e){return Y(e)}function re(e){function t(e){var t=e.context.requestPolicy;return"query"===e.kind&&"network-only"!==t&&("cache-only"===t||l.has(e.key))}function a(e){var t=l.get(e.key);return t=E({},t,{operation:B(e,{cacheOutcome:t?"hit":"miss"})}),"cache-and-network"===e.context.requestPolicy&&(t.stale=!0,ie(h,e)),t}function s(e){return!Y(e)&&t(e)}function c(e){function t(e){i.add(e)}var n=e.operation;if(n){var r=Object.keys(T(e.data,{})).concat(n.context.additionalTypenames||[]);if("mutation"===e.operation.kind){var i=new Set;for(e=0;e<r.length;e++){var o=r[e];(o=d[o]||(d[o]=new Set)).forEach(t),o.clear()}i.forEach((function(e){l.has(e)&&(n=l.get(e).operation,l.delete(e),ie(h,n))}))}else if("query"===n.kind&&e.data)for(l.set(n.key,e),e=0;e<r.length;e++)(d[o=r[e]]||(d[o]=new Set)).add(n.key)}}function f(e){return!Y(e)&&!t(e)}var p=e.forward,h=e.client,l=new Map,d=Object.create(null);return function(e){var t=n(e);return e=i(a)(r(s)(t)),t=o(c)(p(r(ee)(i(te)(u([i(Z)(r(f)(t)),r(ne)(t)]))))),u([e,t])}}function ie(e,t){return e.reexecuteOperation(z(t.kind,t,E({},t.context,{requestPolicy:"network-only"})))}function oe(e){function t(e){a.delete(e.operation.key)}function n(e){var t=e.key;return"teardown"===(e=e.kind)?(a.delete(t),!0):"query"!==e&&"subscription"!==e||(e=a.has(t),a.add(t),!e)}var i=e.forward,a=new Set;return function(e){return e=r(n)(e),o(t)(i(e))}}function ae(e){return"query"===e.kind||"mutation"===e.kind}function ue(e){return"query"!==e.kind&&"mutation"!==e.kind}function se(e){var t=e.forward;return function(e){var i=n(e);e=s((function(e){var t=e.key,n=r((function(e){return"teardown"===e.kind&&e.key===t}))(i),o=R(e),a=M(e,o);return o=D(e,o),l((function(){}))(c(n)(Q(e,a,o)))}))(r(ae)(i));var o=t(r(ue)(i));return u([e,o])}}function ce(){return!1}function fe(){function e(){}return function(t){return r(ce)(o(e)(t))}}var pe=fe();function he(e){return function(t){var n=t.client;return e.reduceRight((function(e,t){return t({client:n,forward:e,dispatchDebug:function(){}})}),t.forward)}}var le=[oe,re,se];function de(e){var t=this;this.activeOperations=Object.create(null),this.queue=[],this.createOperationContext=function(e){return e||(e={}),E({},{url:t.url,fetchOptions:t.fetchOptions,fetch:t.fetch,preferGetMethod:t.preferGetMethod},e,{suspense:e.suspense||!1!==e.suspense&&t.suspense,requestPolicy:e.requestPolicy||t.requestPolicy})},this.createRequestOperation=function(e,n,r){return z(e,n,t.createOperationContext(r))},this.executeQuery=function(e,n){return e=t.createRequestOperation("query",e,n),t.executeRequestOperation(e)},this.executeSubscription=function(e,n){return e=t.createRequestOperation("subscription",e,n),t.executeRequestOperation(e)},this.executeMutation=function(e,n){return e=t.createRequestOperation("mutation",e,n),t.executeRequestOperation(e)},this.url=e.url,this.fetchOptions=e.fetchOptions,this.fetch=e.fetch,this.suspense=!!e.suspense,this.requestPolicy=e.requestPolicy||"cache-first",this.preferGetMethod=!!e.preferGetMethod,this.maskTypename=!!e.maskTypename;var r=d(),i=r.next;this.operations$=r.source;var o=!1;this.dispatchOperation=function(e){for(o=!0,e&&i(e);e=t.queue.shift();)i(e);o=!1},this.reexecuteOperation=function(e){("mutation"===e.kind||0<(t.activeOperations[e.key]||0))&&(t.queue.push(e),o||Promise.resolve().then(t.dispatchOperation))},e=he(void 0!==e.exchanges?e.exchanges:le),this.results$=n(e({client:this,dispatchDebug:H,forward:fe()})(this.operations$)),y(this.results$)}function ye(e){return e.data=U(e.data),e}function ke(e){return new de(e)}function ve(e){var t=e.forward;return function(e){return t(e)}}function me(e){function t(e){var t=e.error;e=e.operation,t&&n(t,e)}var n=e.onError;return function(e){var n=e.forward;return function(e){return o(t)(n(e))}}}function xe(){for(var e=arguments,t=new Map,n=[],r=[],i=Array.isArray(arguments[0])?arguments[0][0]:arguments[0]||"",o=1;o<arguments.length;o++){var a=e[o];a&&a.definitions?r.push.apply(r,a.definitions):i+=a,i+=e[0][o]}return K(t,n,w(i).definitions),K(t,n,r),w({kind:N.DOCUMENT,definitions:n})}function ge(e){function t(t){var a=t.client,c=t.forward;return function(t){var d=e&&"boolean"==typeof e.isClient?!!e.isClient:!a.suspense,y=n(t);return t=c(r(f)(y)),y=i(p)(r(h)(y)),d?y=o(s)(y):t=o(l)(t),u([t,y])}}function a(e){return!W(e)&&void 0!==d[e.key]}function s(e){y.push(e.operation.key),1===y.length&&Promise.resolve().then(c)}function c(){for(var e;e=y.shift();)delete d[e]}function f(e){return!a(e)}function p(e){var t=d[e.key],n=t.error;return{operation:e,data:(t=t.data)?JSON.parse(t):void 0,extensions:void 0,error:n?new S({networkError:n.networkError?Error(n.networkError):void 0,graphQLErrors:n.graphQLErrors&&n.graphQLErrors.length?n.graphQLErrors:void 0}):void 0}}function h(e){return a(e)}function l(e){var t=e.operation;if(!W(t)){var n=e.data;e=e.error;var r={};void 0!==n&&(r.data=JSON.stringify(n)),e&&(r.error={graphQLErrors:e.graphQLErrors.map(X)},e.networkError&&(r.error.networkError=""+e.networkError)),d[t.key]=r}}var d={},y=[];return t.restoreData=function(e){return E(d,e)},t.extractData=function(){return E({},d)},e&&e.initialState&&t.restoreData(e.initialState),t}function Oe(e){function t(e){return"subscription"===(e=e.kind)||!!o&&("query"===e||"mutation"===e)}var i=e.forwardSubscription,o=e.enableAllOperations;return function(e){function o(e){var t=i({key:e.key.toString(36),query:L(e.query),variables:e.variables,context:E({},e.context)});return p((function(n){function r(t){return u(P(e,t))}function i(t){return u(j(e,t))}function o(){c||(c=!0,"subscription"===e.kind&&f.reexecuteOperation(z("teardown",e,e.context)),s())}var a,u=n.next,s=n.complete,c=!1;return Promise.resolve().then((function(){c||(a=t.subscribe({next:r,error:i,complete:o}))})),function(){c=!0,a&&a.unsubscribe()}}))}function a(e){return!l(e)}var f=e.client,h=e.forward,l=t;return function(e){var t=n(e);e=s((function(e){var n=e.key,i=r((function(e){return"teardown"===e.kind&&e.key===n}))(t);return c(i)(o(e))}))(r(l)(t));var i=h(r(a)(t));return u([e,i])}}}de.prototype.onOperationStart=function(e){var t=e.key;this.activeOperations[t]=(this.activeOperations[t]||0)+1,this.dispatchOperation(e)},de.prototype.onOperationEnd=function(e){var t=e.key,n=this.activeOperations[t]||0;if(0>=(this.activeOperations[t]=0>=n?0:n-1)){for(t=this.queue.length-1;0<=t;t--)this.queue[t].key===e.key&&this.queue.splice(t,1);this.dispatchOperation(z("teardown",e,e.context))}},de.prototype.executeRequestOperation=function(e){var n=this,o=r((function(t){return t.operation.key===e.key}))(this.results$);if(this.maskTypename&&(o=i(ye)(o)),"mutation"===e.kind)return t(1)(k((function(){return n.dispatchOperation(e)}))(o));var a=r((function(t){return"teardown"===t.kind&&t.key===e.key}))(this.operations$),s=v((function(){n.onOperationEnd(e)}))(k((function(){n.onOperationStart(e)}))(c(a)(o)));return"query"===e.kind&&e.context.pollInterval?x((function(){return s}))(u([O(0),q(e.context.pollInterval)])):s},de.prototype.query=function(e,t,n){return n&&"boolean"==typeof n.suspense||(n=E({},n,{suspense:!1})),V(this.executeQuery(A(e,t),n))},de.prototype.readQuery=function(e,t,n){var r=null;return b((function(e){r=e}))(this.executeQuery(A(e,t),n)).unsubscribe(),r},de.prototype.subscription=function(e,t,n){return this.executeSubscription(A(e,t),n)},de.prototype.mutation=function(e,t,n){return V(this.executeMutation(A(e,t),n))};export{de as Client,re as cacheExchange,he as composeExchanges,ke as createClient,ve as debugExchange,oe as dedupExchange,le as defaultExchanges,me as errorExchange,pe as fallbackExchangeIO,se as fetchExchange,J as formatDocument,xe as gql,z as makeOperation,U as maskTypename,ge as ssrExchange,Oe as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
